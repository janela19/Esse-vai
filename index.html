<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nossa planilha financeira ‚ù§</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
        }
        .progress-bar-container {
            width: 100%;
            background-color: #e5e7eb;
            border-radius: 9999px;
            overflow: hidden;
            height: 1rem;
        }
        .progress-bar {
            height: 100%;
            transition: width 0.5s ease-in-out;
            border-radius: 9999px;
        }
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            color: #333;
            z-index: 100;
        }
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        #feedback-message {
            z-index: 1000;
        }
    </style>
</head>
<body class="p-4 sm:p-8">
    
    <div id="loading" class="loading-overlay">
        <div class="loading-spinner"></div>
        <p class="mt-4">Carregando...</p>
    </div>

    <div class="max-w-4xl mx-auto bg-white rounded-2xl shadow-xl p-6 sm:p-10 border border-gray-200 hidden" id="main-content">
        <h1 class="text-3xl sm:text-4xl font-bold text-center text-blue-800 mb-2">Nossa planilha financeira ‚ù§</h1>
        <p class="text-center text-gray-500 mb-8 sm:mb-12">Organizar nossa vida financeira para vivermos mais alegres e despreocupados.</p>

        <!-- Se√ß√£o de Or√ßamento -->
        <div class="mb-8">
            <h2 class="text-2xl font-semibold text-purple-600 mb-4">üéØ Or√ßamento Mensal</h2>
            <div class="flex flex-col sm:flex-row gap-4 mb-4">
                <input type="text" id="categoriaNome" placeholder="Categoria (ex: Alimenta√ß√£o)" class="flex-grow p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all">
                <input type="number" id="categoriaValor" placeholder="Or√ßamento (R$)" class="flex-grow p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all">
                <button onclick="adicionarOrcamento()" class="bg-purple-500 text-white font-medium p-3 rounded-lg hover:bg-purple-600 transition-colors shadow-md">Definir Or√ßamento</button>
            </div>
            <div id="listaOrcamentos" class="bg-gray-50 rounded-lg p-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                <p class="text-gray-400 italic md:col-span-2">Nenhum or√ßamento definido ainda.</p>
            </div>
        </div>

        <hr class="border-t-2 border-dashed border-gray-300 my-8 sm:my-10">

        <!-- Se√ß√£o de Receitas -->
        <div class="mb-8">
            <h2 class="text-2xl font-semibold text-green-600 mb-4">üí∞ Receitas</h2>
            <div class="flex flex-col sm:flex-row gap-4 mb-4">
                <input type="text" id="receitaNome" placeholder="Nome da Receita (ex: Sal√°rio)" class="flex-grow p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-green-500 transition-all">
                <input type="number" id="receitaValor" placeholder="Valor (R$)" class="flex-grow p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-green-500 transition-all">
                <button onclick="adicionarReceita()" class="bg-green-500 text-white font-medium p-3 rounded-lg hover:bg-green-600 transition-colors shadow-md">Adicionar</button>
            </div>
            <div id="listaReceitas" class="bg-gray-50 rounded-lg p-4">
                <p class="text-gray-400 italic">Nenhuma receita adicionada ainda.</p>
            </div>
            <div class="mt-4 text-lg font-semibold text-gray-700 flex justify-between items-center">
                <span>Total de Receitas:</span>
                <span id="totalReceitas" class="font-bold text-green-600">R$ 0,00</span>
            </div>
        </div>

        <hr class="border-t-2 border-dashed border-gray-300 my-8 sm:my-10">

        <!-- Se√ß√£o de Despesas Fixas -->
        <div class="mb-8">
            <h2 class="text-2xl font-semibold text-red-600 mb-4">üè† Despesas Fixas</h2>
            <div class="flex flex-col sm:flex-row gap-4 mb-4">
                <input type="text" id="despesaFixaNome" placeholder="Nome da Despesa (ex: Aluguel)" class="flex-grow p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-red-500 transition-all">
                <input type="number" id="despesaFixaValor" placeholder="Valor (R$)" class="flex-grow p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-red-500 transition-all">
                <button onclick="adicionarDespesa('fixa')" class="bg-red-500 text-white font-medium p-3 rounded-lg hover:bg-red-600 transition-colors shadow-md">Adicionar</button>
            </div>
            <div id="listaDespesasFixas" class="bg-gray-50 rounded-lg p-4">
                <p class="text-gray-400 italic">Nenhuma despesa fixa adicionada ainda.</p>
            </div>
        </div>

        <hr class="border-t-2 border-dashed border-gray-300 my-8 sm:my-10">

        <!-- Se√ß√£o de Despesas Vari√°veis -->
        <div class="mb-8">
            <h2 class="text-2xl font-semibold text-red-600 mb-4">üõí Despesas Vari√°veis</h2>
            <div class="flex flex-col sm:flex-row gap-4 mb-4">
                <input type="text" id="despesaVariavelNome" placeholder="Nome da Despesa (ex: Lanches)" class="flex-grow p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-red-500 transition-all">
                <select id="despesaCategoria" class="flex-grow p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-red-500 transition-all">
                    <option value="">Selecione uma categoria (opcional)</option>
                </select>
                <input type="number" id="despesaVariavelValor" placeholder="Valor (R$)" class="flex-grow p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-red-500 transition-all">
                <button onclick="adicionarDespesa('variavel')" class="bg-red-500 text-white font-medium p-3 rounded-lg hover:bg-red-600 transition-colors shadow-md">Adicionar</button>
            </div>
            <div id="listaDespesasVariaveis" class="bg-gray-50 rounded-lg p-4">
                <p class="text-gray-400 italic">Nenhuma despesa vari√°vel adicionada ainda.</p>
            </div>
        </div>

        <hr class="border-t-2 border-dashed border-gray-300 my-8 sm:my-10">

        <!-- Resumo -->
        <div>
            <h2 class="text-2xl font-semibold text-blue-800 mb-4 text-center">üìä Resumo do M√™s</h2>
            <div class="bg-blue-100 p-6 rounded-lg shadow-inner border border-blue-200">
                <div class="text-xl sm:text-2xl text-center font-bold">
                    <span>Total de Despesas:</span>
                    <span id="totalDespesas" class="ml-2 font-bold text-red-600">R$ 0,00</span>
                </div>
                <div class="text-xl sm:text-2xl text-center font-bold mt-4">
                    <span>Saldo Final:</span>
                    <span id="saldoFinal" class="ml-2">R$ 0,00</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Mensagem de feedback - oculta por padr√£o -->
    <div id="feedback-message" class="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-blue-500 text-white text-center p-4 px-6 rounded-full shadow-lg opacity-0 transition-opacity duration-300 ease-in-out hidden">
        <span class="text-3xl">‚ù§</span>
        <p id="feedback-text" class="text-base mt-1"></p>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

    <script>
        // Configura√ß√£o do Firebase
        // IMPORTANTE: NUNCA COLOQUE AS SUAS CHAVES REAIS AQUI se este ficheiro for p√∫blico.
        // SUBSTITUA ESTE OBJETO PELO SEU PR√ìPRIO C√ìDIGO DO FIREBASE.
        // Voc√™ pode encontrar isso no seu projeto do Firebase, em "Configura√ß√µes do Projeto" > "Seus aplicativos"
        const firebaseConfig = {
            apiKey: "AIzaSyBv3WXi-ZNDYkGebzvqEtuqG_NYKpAHolQ", // Coloque a sua chave de API aqui
            authDomain: "financas-10990.firebaseapp.com", // Coloque o seu dom√≠nio de autentica√ß√£o aqui
            projectId: "financas-10990", // Coloque o ID do seu projeto aqui
        };

        // Elementos do DOM
        const loadingDiv = document.getElementById('loading');
        const mainContentDiv = document.getElementById('main-content');
        const receitaNomeInput = document.getElementById('receitaNome');
        const receitaValorInput = document.getElementById('receitaValor');
        const listaReceitasDiv = document.getElementById('listaReceitas');
        const totalReceitasSpan = document.getElementById('totalReceitas');

        const despesaFixaNomeInput = document.getElementById('despesaFixaNome');
        const despesaFixaValorInput = document.getElementById('despesaFixaValor');
        const listaDespesasFixasDiv = document.getElementById('listaDespesasFixas');
        
        const despesaVariavelNomeInput = document.getElementById('despesaVariavelNome');
        const despesaCategoriaSelect = document.getElementById('despesaCategoria');
        const despesaVariavelValorInput = document.getElementById('despesaVariavelValor');
        const listaDespesasVariaveisDiv = document.getElementById('listaDespesasVariaveis');
        
        const totalDespesasSpan = document.getElementById('totalDespesas');
        const categoriaNomeInput = document.getElementById('categoriaNome');
        const categoriaValorInput = document.getElementById('categoriaValor');
        const listaOrcamentosDiv = document.getElementById('listaOrcamentos');
        const saldoFinalSpan = document.getElementById('saldoFinal');
        const feedbackMessage = document.getElementById('feedback-message');
        const feedbackText = document.getElementById('feedback-text');

        const feedbackMessages = [
            "Obrigado por fazer isso!",
            "Ei... j√° falei o qu√£o voc√™ √© incr√≠vel hoje?",
            "Nossa, como voc√™ √© linda(o) quando faz isso",
            "Quer? Quer? Quer?",
            "E de quem √© a comida do pitoco?",
            "Quando olhei para seus olhos foi como se perdesse no oceano da sua alma",
            "Voc√™ √© o meu amor, e juntos somos uma equipe imbat√≠vel.",
            "Meu maior tesouro n√£o est√° aqui, mas sim em voc√™.",
            "Cada despesa registrada √© um passo nosso rumo aos nossos sonhos.",
            "N√£o h√° desafio financeiro que a gente n√£o possa vencer.",
            "Sua dedica√ß√£o me inspira. Eu te amo!",
            "Fico t√£o feliz por estarmos nessa jornada juntos.",
            "Nossa parceria vale mais do que qualquer dinheiro.",
            "Voc√™ √© a pessoa mais dedicada que eu conhe√ßo.",
            "Estou aqui com voc√™ em cada real, em cada sonho.",
            "A felicidade √© o nosso maior lucro."
        ];

        // Refer√™ncias Firestore
        let db;
        let userId = 'user_id_12345'; // ID √∫nico para salvar os dados

        // Arrays locais para renderiza√ß√£o
        let receitas = [];
        let despesas = [];
        let orcamentos = {};

        // Inicializa√ß√£o do Firebase e autentica√ß√£o an√¥nima
        const initFirebase = async () => {
            try {
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                db = firebase.firestore();

                // Gera um ID de usu√°rio √∫nico e persistente para este navegador
                let uniqueId = localStorage.getItem('uniqueUserId');
                if (!uniqueId) {
                    uniqueId = 'user_' + Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
                    localStorage.setItem('uniqueUserId', uniqueId);
                }
                userId = uniqueId;

                // Carrega os dados do Firestore
                carregarDados();
                loadingDiv.classList.add('hidden');
                mainContentDiv.classList.remove('hidden');
            } catch (error) {
                loadingDiv.innerHTML = `<p class="text-red-500 text-center">Erro ao carregar. Por favor, verifique as suas credenciais do Firebase e a sua conex√£o com a internet.</p>`;
                console.error("Erro de inicializa√ß√£o do Firebase:", error);
            }
        };

        // Fun√ß√£o para formatar o valor para moeda BRL
        const formatarMoeda = (valor) => {
            return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(valor);
        };

        // Fun√ß√£o para calcular os totais e o saldo final
        const calcularTotais = () => {
            const totalReceitas = receitas.reduce((acc, item) => acc + item.valor, 0);
            const totalDespesas = despesas.reduce((acc, item) => acc + item.valor, 0);
            const saldoFinal = totalReceitas - totalDespesas;

            totalReceitasSpan.textContent = formatarMoeda(totalReceitas);
            totalDespesasSpan.textContent = formatarMoeda(totalDespesas);
            saldoFinalSpan.textContent = formatarMoeda(saldoFinal);

            if (saldoFinal >= 0) {
                saldoFinalSpan.classList.remove('text-red-600');
                saldoFinalSpan.classList.add('text-green-600');
            } else {
                saldoFinalSpan.classList.remove('text-green-600');
                saldoFinalSpan.classList.add('text-red-600');
            }

            atualizarProgressoOrcamentos();
        };

        // Fun√ß√£o para atualizar as barras de progresso do or√ßamento
        const atualizarProgressoOrcamentos = () => {
            for (const categoria in orcamentos) {
                const despesasDaCategoria = despesas.filter(item => item.categoria === categoria && item.tipo === 'variavel');
                const totalGasto = despesasDaCategoria.reduce((acc, item) => acc + item.valor, 0);
                const orcamentoTotal = orcamentos[categoria].valor;
                const percentual = Math.min((totalGasto / orcamentoTotal) * 100, 100);

                const progressBar = document.querySelector(`#progresso-${categoria.replace(/\s+/g, '-')}`);
                if (progressBar) {
                    progressBar.style.width = `${percentual}%`;
                    if (percentual >= 100) {
                        progressBar.classList.remove('bg-purple-400', 'bg-yellow-500');
                        progressBar.classList.add('bg-red-500');
                    } else if (percentual > 75) {
                         progressBar.classList.remove('bg-purple-400', 'bg-red-500');
                         progressBar.classList.add('bg-yellow-500');
                    } else {
                        progressBar.classList.remove('bg-red-500', 'bg-yellow-500');
                        progressBar.classList.add('bg-purple-400');
                    }
                }

                const totalGastoSpan = document.querySelector(`#gasto-${categoria.replace(/\s+/g, '-')}`);
                if (totalGastoSpan) {
                    totalGastoSpan.textContent = `${formatarMoeda(totalGasto)} / ${formatarMoeda(orcamentoTotal)}`;
                }
            }
        };

        // Fun√ß√£o para renderizar as listas
        const renderizarListas = () => {
            listaReceitasDiv.innerHTML = '';
            if (receitas.length === 0) {
                listaReceitasDiv.innerHTML = '<p class="text-gray-400 italic">Nenhuma receita adicionada ainda.</p>';
            } else {
                receitas.forEach((item) => {
                    const li = document.createElement('div');
                    li.className = 'flex justify-between items-center py-2 border-b last:border-b-0';
                    li.innerHTML = `
                        <span class="text-sm font-medium text-gray-600">${item.nome}</span>
                        <div class="flex items-center gap-2">
                            <span class="text-sm font-semibold text-green-600">${formatarMoeda(item.valor)}</span>
                            <button onclick="removerItem('receita', '${item.id}')" class="bg-red-100 text-red-600 p-1 rounded-full hover:bg-red-200 transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm6 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </div>
                    `;
                    listaReceitasDiv.appendChild(li);
                });
            }

            listaDespesasFixasDiv.innerHTML = '';
            const despesasFixas = despesas.filter(d => d.tipo === 'fixa');
            if (despesasFixas.length === 0) {
                listaDespesasFixasDiv.innerHTML = '<p class="text-gray-400 italic">Nenhuma despesa fixa adicionada ainda.</p>';
            } else {
                despesasFixas.forEach((item) => {
                    const li = document.createElement('div');
                    li.className = 'flex justify-between items-center py-2 border-b last:border-b-0';
                    li.innerHTML = `
                        <span class="text-sm font-medium text-gray-600">${item.nome}</span>
                        <div class="flex items-center gap-2">
                            <span class="text-sm font-semibold text-red-600">${formatarMoeda(item.valor)}</span>
                            <button onclick="removerItem('despesa', '${item.id}')" class="bg-red-100 text-red-600 p-1 rounded-full hover:bg-red-200 transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm6 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </div>
                    `;
                    listaDespesasFixasDiv.appendChild(li);
                });
            }

            listaDespesasVariaveisDiv.innerHTML = '';
            const despesasVariaveis = despesas.filter(d => d.tipo === 'variavel');
            if (despesasVariaveis.length === 0) {
                listaDespesasVariaveisDiv.innerHTML = '<p class="text-gray-400 italic">Nenhuma despesa vari√°vel adicionada ainda.</p>';
            } else {
                despesasVariaveis.forEach((item) => {
                    const li = document.createElement('div');
                    li.className = 'flex justify-between items-center py-2 border-b last:border-b-0';
                    const categoriaSpan = item.categoria ? `<span class="text-xs text-gray-400">(${item.categoria})</span>` : '';
                    li.innerHTML = `
                        <div class="flex flex-col">
                            <span class="text-sm font-medium text-gray-600">${item.nome}</span>
                            ${categoriaSpan}
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="text-sm font-semibold text-red-600">${formatarMoeda(item.valor)}</span>
                            <button onclick="removerItem('despesa', '${item.id}')" class="bg-red-100 text-red-600 p-1 rounded-full hover:bg-red-200 transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm6 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </div>
                    `;
                    listaDespesasVariaveisDiv.appendChild(li);
                });
            }
            renderizarOrcamentos();
        };

        // Fun√ß√µes para manipular o Firestore
        window.adicionarReceita = async () => {
            const nome = receitaNomeInput.value.trim();
            const valor = parseFloat(receitaValorInput.value);

            if (nome && !isNaN(valor) && valor > 0) {
                await db.collection(`users/${userId}/receitas`).add({ nome, valor, timestamp: new Date() });
                receitaNomeInput.value = '';
                receitaValorInput.value = '';
            } else {
                console.error("Dados inv√°lidos.");
            }
        };

        window.adicionarDespesa = async (tipo) => {
            let nome, valor, categoria = '';

            if (tipo === 'fixa') {
                nome = despesaFixaNomeInput.value.trim();
                valor = parseFloat(despesaFixaValorInput.value);
            } else if (tipo === 'variavel') {
                nome = despesaVariavelNomeInput.value.trim();
                valor = parseFloat(despesaVariavelValorInput.value);
                categoria = despesaCategoriaSelect.value || '';
            }

            if (nome && !isNaN(valor) && valor > 0) {
                await db.collection(`users/${userId}/despesas`).add({ nome, valor, categoria, tipo, timestamp: new Date() });
                
                if (tipo === 'fixa') {
                    despesaFixaNomeInput.value = '';
                    despesaFixaValorInput.value = '';
                } else if (tipo === 'variavel') {
                    despesaVariavelNomeInput.value = '';
                    despesaCategoriaSelect.value = '';
                    despesaVariavelValorInput.value = '';

                    const randomMessage = feedbackMessages[Math.floor(Math.random() * feedbackMessages.length)];
                    feedbackText.textContent = randomMessage;

                    // Mostra a mensagem de feedback
                    feedbackMessage.classList.remove('hidden', 'opacity-0');
                    feedbackMessage.classList.add('opacity-100');

                    // Oculta a mensagem ap√≥s 2 segundos
                    setTimeout(() => {
                        feedbackMessage.classList.remove('opacity-100');
                        feedbackMessage.classList.add('opacity-0');
                        setTimeout(() => {
                            feedbackMessage.classList.add('hidden');
                        }, 300);
                    }, 2000);
                }
            } else {
                console.error("Dados inv√°lidos.");
            }
        };
        
        window.adicionarOrcamento = async () => {
            const nome = categoriaNomeInput.value.trim();
            const valor = parseFloat(categoriaValorInput.value);

            if (nome && !isNaN(valor) && valor > 0) {
                await db.collection(`users/${userId}/orcamentos`).doc(nome).set({ valor });
                categoriaNomeInput.value = '';
                categoriaValorInput.value = '';
            } else {
                console.error("Dados inv√°lidos.");
            }
        };

        window.removerItem = async (tipo, id) => {
            if (tipo === 'receita') {
                await db.collection(`users/${userId}/receitas`).doc(id).delete();
            } else if (tipo === 'despesa') {
                await db.collection(`users/${userId}/despesas`).doc(id).delete();
            } else if (tipo === 'orcamento') {
                await db.collection(`users/${userId}/orcamentos`).doc(id).delete();
            }
        };
        
        const renderizarOrcamentos = () => {
            listaOrcamentosDiv.innerHTML = '';
            const categorias = Object.keys(orcamentos);
            if (categorias.length === 0) {
                listaOrcamentosDiv.innerHTML = '<p class="text-gray-400 italic md:col-span-2">Nenhum or√ßamento definido ainda.</p>';
            } else {
                categorias.forEach((categoria) => {
                    const orcamentoTotal = orcamentos[categoria].valor;
                    const card = document.createElement('div');
                    card.className = 'bg-white rounded-xl shadow-lg p-4 flex flex-col justify-between border border-purple-200';
                    card.innerHTML = `
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-lg font-semibold text-purple-700">${categoria}</span>
                            <button onclick="removerItem('orcamento', '${categoria}')" class="bg-red-100 text-red-600 p-1 rounded-full hover:bg-red-200 transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm6 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </div>
                        <div class="text-sm font-medium text-gray-500 mb-2">
                            <span id="gasto-${categoria.replace(/\s+/g, '-')}" class="font-bold">R$ 0,00</span> / ${formatarMoeda(orcamentoTotal)}
                        </div>
                        <div class="progress-bar-container">
                            <div id="progresso-${categoria.replace(/\s+/g, '-')}" class="progress-bar bg-purple-400" style="width: 0%;"></div>
                        </div>
                    `;
                    listaOrcamentosDiv.appendChild(card);
                });
            }
        };

        const atualizarSelectCategorias = () => {
            despesaCategoriaSelect.innerHTML = '<option value="">Selecione uma categoria (opcional)</option>';
            for (const categoria in orcamentos) {
                const option = document.createElement('option');
                option.value = categoria;
                option.textContent = categoria;
                despesaCategoriaSelect.appendChild(option);
            }
        };

        const carregarDados = () => {
            db.collection(`users/${userId}/receitas`).orderBy('timestamp').onSnapshot(snapshot => {
                receitas = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderizarListas();
                calcularTotais();
            });

            db.collection(`users/${userId}/despesas`).orderBy('timestamp').onSnapshot(snapshot => {
                despesas = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderizarListas();
                calcularTotais();
            });

            db.collection(`users/${userId}/orcamentos`).onSnapshot(snapshot => {
                const orcamentosTemp = {};
                snapshot.docs.forEach(doc => {
                    orcamentosTemp[doc.id] = doc.data();
                });
                orcamentos = orcamentosTemp;
                renderizarListas();
                calcularTotais();
                atualizarSelectCategorias();
            });
        };

        window.onload = initFirebase;
    </script>
</body>
</html>
